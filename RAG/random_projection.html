<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RP: Dimensional Shadow // Window Agnostic</title>
    <style>
        :root {
            --term-green: #33FF00;
            --term-black: #050505;
            --term-dim: #1a8000;
            --font-stack: 'Courier New', Courier, monospace;
        }

        body {
            margin: 0;
            background-color: var(--term-black);
            font-family: var(--font-stack);
            color: var(--term-green);
            user-select: none;
            display: flex;
            flex-direction: row;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }

        /* 1. UI SIDEBAR - WINDOW AGNOSTIC REFACTOR */
        #ui-layer {
            position: relative;
            z-index: 2;
            width: clamp(280px, 25vw, 380px);
            height: 100%;
            flex-shrink: 0;
            
            /* Fluid Layout */
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* Anchors Header to top, Button to bottom */
            padding: clamp(10px, 2vh, 20px);
            box-sizing: border-box;
            
            background: linear-gradient(180deg, rgba(10,10,10,1) 0%, rgba(0,0,0,0.95) 100%);
            border-right: 2px solid var(--term-dim);
            overflow: hidden; /* Strict removal of scrollbars */
        }

        .header-group {
            flex-shrink: 0;
        }

        h1 {
            font-size: clamp(1.2rem, 4vh, 1.8rem);
            text-transform: uppercase;
            border-bottom: 2px solid var(--term-green);
            display: inline-block;
            margin: 0 0 0.5rem 0;
            text-shadow: 0 0 8px var(--term-green);
            line-height: 1.2;
        }

        .subtitle {
            font-size: clamp(0.6rem, 1.2vh, 0.8rem);
            color: #888;
            display: block;
        }

        .panel-content {
            display: flex;
            flex-direction: column;
            gap: 2vh; /* Relative spacing */
            flex-grow: 1;
            justify-content: center; /* Centers stats in middle space */
            min-height: 0;
        }

        .status-line {
            border-bottom: 1px dashed var(--term-dim); 
            padding-bottom: 0.5vh;
            font-size: clamp(0.75rem, 1.5vh, 0.9rem);
            font-weight: bold;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: clamp(0.7rem, 1.4vh, 0.85rem);
            gap: 1rem;
        }

        .bar-container {
            flex-grow: 1;
            height: 1.5vh; /* Proportional height */
            background: #111;
            border: 1px solid var(--term-dim);
        }

        .bar-fill {
            height: 100%;
            background: var(--term-green);
            width: 0%;
            transition: width 0.3s ease-out;
            box-shadow: 0 0 4px var(--term-green);
        }

        #ratio-text {
            font-size: clamp(0.75rem, 1.5vh, 1rem);
            color: #fff;
            text-align: center;
        }

        .obs-text {
            font-size: clamp(0.65rem, 1.2vh, 0.8rem); 
            line-height: 1.4; 
            color: #aaa;
            background: rgba(255, 255, 255, 0.05);
            padding: 1vh;
            border-left: 2px solid var(--term-dim);
            margin: 0;
            flex-shrink: 1;
            overflow: hidden;
        }

        button {
            background: #000;
            color: var(--term-green);
            border: 2px solid var(--term-green);
            padding: clamp(0.5rem, 1.8vh, 1rem);
            font-family: var(--font-stack);
            font-weight: bold;
            font-size: clamp(0.8rem, 1.4vh, 1rem);
            cursor: pointer;
            text-transform: uppercase;
            box-shadow: 4px 4px 0px var(--term-dim);
            transition: transform 0.1s, box-shadow 0.1s;
            flex-shrink: 0;
            margin-top: 1vh;
            width: 100%;
        }

        button:active {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0px var(--term-dim);
        }

        button:hover {
            background: var(--term-green);
            color: #000;
        }

        /* 2. 3D CANVAS CONTAINER */
        #canvas-container {
            position: relative;
            flex-grow: 1;
            height: 100%;
            width: auto;
            z-index: 1;
            overflow: hidden;
            background-color: var(--term-black);
        }

        /* CRT Filter */
        .scanlines {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            z-index: 10;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
        }

        /* MOBILE OVERRIDE */
        @media (max-width: 800px) {
            body { flex-direction: column; }
            #ui-layer {
                width: 100%;
                height: auto;
                max-height: 35vh;
                border-right: none;
                border-bottom: 2px solid var(--term-dim);
            }
            .obs-text { display: none; } /* Hide on small screens to fit button */
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>

    <div class="scanlines"></div>

    <div id="ui-layer">
        <div class="header-group">
            <h1>Dimensional Shadow</h1>
            <span class="subtitle">// RANDOM PROJECTION VISUALIZER</span>
        </div>

        <div class="panel-content">
            <div class="status-line">STATUS: <span id="status-text">ONLINE</span></div>
            
            <div class="stat-row">
                <span>High-D Dist:</span>
                <div class="bar-container"><div id="bar-high" class="bar-fill"></div></div>
            </div>
            <div class="stat-row">
                <span>Low-D Dist:</span>
                <div class="bar-container"><div id="bar-low" class="bar-fill"></div></div>
            </div>
            <div id="ratio-text">Ratio: 1.00</div>

            <p class="obs-text">
                > OBSERVATION: Topology remains stable under projection.
            </p>
        </div>

        <button id="btn-reroll">[ RE-INITIALIZE MATRIX ]</button>
    </div>

    <div id="canvas-container"></div>

    <script>
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x050505);

        const camera = new THREE.OrthographicCamera(-1, 1, 1, -1, 1, 1000);
        camera.position.set(20, 20, 20); 
        camera.lookAt(0, 0, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: false });
        container.appendChild(renderer.domElement);

        // Scene Groups
        const groupHigh = new THREE.Group();
        const groupLow = new THREE.Group();
        scene.add(groupHigh); scene.add(groupLow);

        // Cube Wireframe
        const wireCube = new THREE.LineSegments(
            new THREE.WireframeGeometry(new THREE.BoxGeometry(8, 6, 8)), 
            new THREE.LineBasicMaterial({ color: 0x444444 })
        );
        wireCube.position.y = 6;
        groupHigh.add(wireCube);

        // Floor Grid - UPDATED FOR GLOW
        // Using Theme colors: 0x33FF00 (Main) and 0x1a8000 (Dim)
        const grid = new THREE.GridHelper(20, 20, 0x33FF00, 0x1a8000);
        grid.position.y = -6;
        // Setting transparency makes it blend better with the black background, creating a "glow" feel
        grid.material.opacity = 0.9;
        grid.material.transparent = true;
        groupLow.add(grid);

        // Points
        const points = [];
        const sphereGeo = new THREE.SphereGeometry(0.3, 8, 8);
        const pointMat = new THREE.MeshBasicMaterial({ color: 0x33FF00 });

        for(let i=0; i<16; i++) {
            const p = new THREE.Mesh(sphereGeo, pointMat);
            p.position.set((Math.random()-0.5)*6, (Math.random()-0.5)*4, (Math.random()-0.5)*6);
            wireCube.add(p);
            
            const s = new THREE.Mesh(new THREE.CircleGeometry(0.2, 8), new THREE.MeshBasicMaterial({color: 0x1a8000}));
            s.rotation.x = -Math.PI/2;
            groupLow.add(s);
            points.push({ mesh: p, shadow: s });
        }

        let targetQuat = new THREE.Quaternion();
        let currentQuat = new THREE.Quaternion();

        function reroll() {
            targetQuat.setFromEuler(new THREE.Euler(Math.random()*Math.PI, Math.random()*Math.PI, 0));
        }

        function onResize() {
            const w = container.clientWidth, h = container.clientHeight;
            const aspect = w / h;
            const fSize = aspect < 1 ? 30/aspect : 30;
            camera.left = -fSize*aspect/2; camera.right = fSize*aspect/2;
            camera.top = fSize/2; camera.bottom = -fSize/2;
            camera.updateProjectionMatrix();
            renderer.setSize(w, h);
        }

        window.addEventListener('resize', onResize);
        document.getElementById('btn-reroll').onclick = reroll;
        
        function animate() {
            requestAnimationFrame(animate);
            currentQuat.slerp(targetQuat, 0.05);
            wireCube.quaternion.copy(currentQuat);
            
            points.forEach(p => {
                const worldPos = new THREE.Vector3();
                p.mesh.getWorldPosition(worldPos);
                p.shadow.position.set(worldPos.x, -5.9, worldPos.z);
            });

            const p1 = new THREE.Vector3(), p2 = new THREE.Vector3();
            points[0].mesh.getWorldPosition(p1); points[1].mesh.getWorldPosition(p2);
            const dH = p1.distanceTo(p2);
            const dL = Math.sqrt((p1.x-p2.x)**2 + (p1.z-p2.z)**2);
            
            document.getElementById('bar-high').style.width = Math.min((dH/10)*100, 100) + '%';
            document.getElementById('bar-low').style.width = Math.min((dL/10)*100, 100) + '%';
            document.getElementById('ratio-text').innerText = `Ratio: ${(dL/dH).toFixed(2)}`;

            renderer.render(scene, camera);
        }

        onResize();
        reroll();
        animate();
    </script>
</body>
</html>